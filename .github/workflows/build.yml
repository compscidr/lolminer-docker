name: Build container
on:
  push:

jobs:
  build-nvidia:
      strategy:
        matrix:
          os: [ubuntu20.04]
          cuda: [11.4.2-base]
          lolminer: [1.52a, 1.53]
      runs-on: ubuntu-20.04
      name: Build container
      steps:
        - uses: actions/checkout@v3
        - name: build nvidia image
          run: docker build -f Dockerfile --build-arg LOLMINER_VERSION=${{ matrix.lolminer }} --build-arg OS_VERSION=${{ matrix.cuda }} --build-arg CUDA_VERSION=${{ matrix.cuda }} --target nvidia -t lolminer-docker:nvidia-${{ github.sha }} .

  build-amd:
    steps:
      - uses: actions/checkout@v3
      - name: build amd image
        run: docker build -f Dockerfile --target amd -t lolminer-docker:amd-${{ github.sha }} .
